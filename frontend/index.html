<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <base target="_top">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>

  
  <?!= incluir('css'); ?>
  <script>
    // Variables de servidor inyectadas vÃ­a Template (disponibles para js.txt)
    window.G_LOGIN_MODE = "<?!= loginMode ?>";
    window.G_LOGIN_TOKEN = "<?!= loginToken ?>";
  </script>
</head>
<body>

  <div id="login-screen" class="container-login">
    <div class="login-card-blue animate-in">
      
      <h2 id="login-title" class="login-title-white">Acceso Administrativo</h2>

      <div id="login-status-banner" class="status-banner-blue hidden">
        <div class="spinner-tiny-white"></div>
        <span id="login-msg">Verificando credenciales...</span>
      </div>
      
      <!-- NUEVA PANTALLA DE SELECCIÃ“N (Gateway) -->
      <div id="gateway-selection">
        <p class="gateway-subtitle">Selecciona tu mÃ©todo de acceso:</p>
        
        <button class="btn-gateway" onclick="loginNativoGoogle()">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 48 48">
            <g><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24s.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></g>
          </svg>
          Soy Docente / Admin
        </button>

        <button class="btn-gateway" onclick="mostrarLoginAlumno()">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 48 48">
            <g><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24s.92 7.54 2.56 10.78l7.97-6.19z"></path><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path><path fill="none" d="M0 0h48v48H0z"></path></g>
          </svg>
          Soy Alumno
        </button>
      </div>

      <!-- CONTENEDOR DE FORMULARIO (Oculto inicialmente) -->
      <div id="login-form-container" class="hidden">
        <div id="login-status-banner" class="status-banner-blue hidden">
          <div class="spinner-white"></div>
          <span id="login-msg">Validando...</span>
        </div>

        <div class="input-wrapper-modern">
          <input type="email" id="email" class="input-flat" placeholder="Correo ElectrÃ³nico">
          <div class="icon-box">ğŸ‘¤</div>
        </div>

        <div class="input-wrapper-modern" id="pass-container">
          <input type="password" id="pass" class="input-flat" placeholder="ContraseÃ±a">
          <div class="icon-box">ğŸ”’</div>
        </div>

        <a class="forgot-link" id="link-recuperar" onclick="recuperarPassword()" style="display:block; margin-bottom: 2rem;">Â¿Olvidaste tu contraseÃ±a?</a>

        <div style="margin-top: 2rem;">
          <button class="btn-login-white" onclick="procesarLogin()">
            <span id="btn-text">Iniciar SesiÃ³n</span>
            <div id="btn-loader" class="spinner-blue hidden"></div>
          </button>
        </div>

        <p class="back-to-selection" onclick="volverASeleccion()">â¬… Volver a selecciÃ³n</p>
      </div>

      <!-- El botÃ³n de Google nativo viejo ya no es necesario aquÃ­ porque estÃ¡ en el gateway -->
      <div id="google-login-button-container" class="hidden"></div>
      
    </div>
  </div>

  <!-- === PORTAL DEL ALUMNO === -->
  <div id="student-screen" class="hidden" style="min-height:100vh; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 20px;">
    <header style="display:flex; justify-content:space-between; align-items:center; padding:15px 25px; background:rgba(30,41,59,0.9); border-radius:12px; margin-bottom:25px; border:1px solid #334155;">
      <div style="display:flex; align-items:center; gap:10px;">
        <span style="font-size:1.5rem;">ğŸ“</span>
        <div>
          <h2 id="student-name" style="color:white; margin:0; font-size:1.2rem;">Hola, Alumno</h2>
          <small style="color:#94a3b8;">Portal del Estudiante</small>
        </div>
      </div>
      <div class="nav-actions">
        <button onclick="irAMisEventos()" class="btn-alt" style="border-color:#60a5fa; color:#60a5fa;" title="Mis Cursos">ğŸ“š <span class="btn-text">Mis Cursos</span></button>
        <button onclick="irAMiHorario()" class="btn-alt" style="border-color:#60a5fa; color:#60a5fa;" title="Mi Horario">ğŸ“… <span class="btn-text">Mi Horario</span></button>
        <button onclick="irADiplomas()" class="btn-alt" style="border-color:#60a5fa; color:#60a5fa;" title="Diplomas">ğŸ“ <span class="btn-text">Diplomas</span></button>
        <div id="refresh-student" class="bell-container" onclick="location.reload()" title="Recargar pÃ¡gina">
          <span style="font-size:1.3rem;">ğŸ”„</span>
        </div>
        <button onclick="logoutAlumno()" class="btn-salir" title="Salir">ğŸšª <span class="btn-text">Salir</span></button>
      </div>
    </header>
    <div id="student-content" style="color:white;">
      <!-- Contenido dinÃ¡mico del portal -->
    </div>
  </div>

  <div id="main-screen" class="hidden">
    <header>
      <div class="brand">ğŸš€ <strong>Eventos Manager</strong></div>
      <div class="nav-actions">
        <span id="user-display" style="margin-right:10px; font-size:0.85rem; border-right: 1px solid #334155; padding-right:15px;"></span>
        <button id="btn-backup-bd" onclick="descargarBackupBD()" class="btn-alt hidden" title="Backup BD">ğŸ’¾ <span class="btn-text">Backup BD</span></button>
        <button id="btn-logs" onclick="irALogs()" class="btn-alt hidden" title="AuditorÃ­a">ğŸ“œ <span class="btn-text">AuditorÃ­a</span></button>
        <button id="btn-usuarios-config" onclick="irAGestionUsuarios()" class="btn-alt hidden" title="Usuarios">ğŸ‘¥ <span class="btn-text">Usuarios</span></button>
        <button id="btn-participantes-crud" onclick="irACrudParticipantes()" class="btn-alt hidden" title="Directorio Alumnos">ğŸ‘¥ <span class="btn-text">Directorio Alumnos</span></button>
        <button id="btn-admin-config" onclick="irACrearEvento()" class="btn-p hidden" title="Configurar Taller">âš™ï¸ <span class="btn-text">Configurar Taller</span></button>
        <button id="btn-stats" onclick="irAStats()" class="btn-alt hidden" title="EstadÃ­sticas">ğŸ“Š <span class="btn-text">EstadÃ­sticas</span></button>
        <button id="btn-reportes" onclick="irAReportes()" class="btn-alt hidden" title="Reportes">ğŸ“ˆ <span class="btn-text">Reportes</span></button>
        
        <button onclick="irAMiHorario()" class="btn-alt" title="Mi Horario">ğŸ“… <span class="btn-text">Mi Horario</span></button>
        <div id="refresh-main" class="bell-container" onclick="location.reload()" title="Recargar pÃ¡gina">
          <span style="font-size:1.3rem;">ğŸ”„</span>
        </div>
        <button onclick="logout()" class="btn-salir" title="Salir">ğŸšª <span class="btn-text">Salir</span></button>
        
      </div>
    </header>

    <main style="padding-top: 2rem;">
      
     <section id="stats-section" class="app-section">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
          <div>
             <h2 style="margin:0; color:#1e3a8a;">ğŸ“Š Tablero de Control AcadÃ©mico</h2>
             <p style="margin:0; color:#64748b; font-size:0.9rem;">MÃ©tricas de rendimiento y calidad educativa</p>
          </div>
          <button class="btn-back" onclick="irAEventos()" title="Volver">â¬… <span class="btn-text">Volver</span></button>
        </div>

        <div class="card" style="margin-bottom:10px; display:flex; gap:10px; align-items:end; flex-wrap:wrap; background:#f8fafc; border:1px solid #e2e8f0; padding: 15px;">
          <div style="flex:1; min-width:200px;">
            <label class="label-form">Filtrar por Docente</label>
            <select id="filtro-docente" class="input-flat" style="background:white;"><option>Todos los Docentes</option></select>
          </div>
          <div style="flex:1; min-width:150px;">
             <label class="label-form">Desde</label>
             <input type="date" id="filtro-inicio" class="input-flat" style="background:white;">
          </div>
          <div style="flex:1; min-width:150px;">
             <label class="label-form">Hasta</label>
             <input type="date" id="filtro-fin" class="input-flat" style="background:white;">
          </div>
          <button onclick="cargarDashboardPro()" class="btn-p" title="Filtrar">ğŸ” <span class="btn-text">Filtrar</span></button>
          <button onclick="descargarReporteExcel()" class="btn-alt" style="background:#10b981; color:white; border:none;" title="Excel">ğŸ“¥ <span class="btn-text">Excel</span></button>
        </div>

        <div class="grid-metrics" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:15px; margin-bottom:15px;">
          
          <div class="card-metric" style="background:white; color:#1e293b; border:1px solid #e2e8f0; position:relative; overflow:hidden; padding:15px;">
            <div style="position:relative; z-index:2;">
               <div class="metric-label" style="color:#64748b;">Total Inscritos</div>
               <div class="metric-value" id="kpi-inscritos" style="color:#1e3a8a;">0</div>
               <small style="color:#10b981;">ğŸ‘¥ Alumnos Activos</small>
            </div>
            <div style="position:absolute; right:-10px; bottom:-10px; font-size:5rem; opacity:0.05; color:#000;">ğŸ“</div>
          </div>

          <div class="card-metric" style="background:#3b82f6; color:white; padding:15px;">
            <div class="metric-label" style="opacity:0.8;">Promedio General</div>
            <div class="metric-value" id="kpi-promedio">0.0</div>
            <small style="opacity:0.9;">â­ Calidad AcadÃ©mica</small>
          </div>

          <div class="card-metric" style="background:#10b981; color:white; padding:15px;">
            <div class="metric-label" style="opacity:0.8;">Tasa de AprobaciÃ³n</div>
            <div class="metric-value" id="kpi-aprobacion">0%</div>
            <small style="opacity:0.9;">ğŸ“ˆ Ã‰xito Estudiantil</small>
          </div>

          <div class="card-metric" style="background:#f59e0b; color:white; padding:15px;">
            <div class="metric-label" style="opacity:0.8;">Docente Top</div>
            <div class="metric-value" id="kpi-docente" style="font-size:1.1rem; margin-top:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">---</div>
            <small style="opacity:0.9;">ğŸ† Mejor RetenciÃ³n</small>
          </div>
        </div>

        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:15px;">
           
           <div class="card">
              <h4 style="margin-bottom:10px; color:#1e3a8a; font-size:1rem;">ğŸ“Š Rendimiento AcadÃ©mico por Curso</h4>
              <div style="height: 200px;">
                <canvas id="chartPromedios"></canvas>
              </div>
           </div>

           <div class="card">
              <h4 style="margin-bottom:10px; color:#1e3a8a; font-size:1rem;">ğŸ© DistribuciÃ³n de Estatus</h4>
              <div style="height: 200px; display:flex; justify-content:center;">
                <canvas id="chartDistribucion"></canvas>
              </div>
           </div>

        </div>
      </section>
      <section id="eventos-section">
        <div style="padding: 0 5% 1.5rem 5%; display:flex; justify-content:space-between; align-items:center;">
          <h2 style="margin:0;">Talleres Disponibles</h2>
          <div style="display:flex; gap:15px; align-items:center;">
             <div style="display:flex;">
                <button class="btn-view active" id="btn-view-cards" onclick="setEventView('cards')" title="Vista Tarjetas">ğŸ“‡ <span class="btn-text">Tarjeta</span></button>
                <button class="btn-view" id="btn-view-list" onclick="setEventView('list')" title="Vista Lista">ğŸ“„ <span class="btn-text">Lista</span></button>
             </div>
             <button class="btn-alt" onclick="irAGestion()" title="Inscribir Nuevo Alumno">â• <span class="btn-text">Inscribir Nuevo Alumno</span></button>
          </div>
        </div>
        <div id="eventos-list" class="grid-eventos">
          </div>
      </section>

      <section id="crear-evento-section" class="hidden animate-in">
        <div style="max-width: 550px; margin: 0 auto; background: var(--card-dark); padding: 2rem; border-radius: 20px;">
          <button class="btn-back" onclick="irAEventos()" title="Volver">â¬… <span class="btn-text">Volver</span></button>
          <h2 id="titulo-taller" style="margin-top:1.5rem;">Configurar Taller</h2>
          
          <input type="hidden" id="ev-id"> <div class="input-group">
            <label class="label-form">Nombre del Taller <span class="required">(*)</span></label>
            <input type="text" id="ev-nombre">
          </div>
          
          <div style="display:flex; gap:10px;">
            <div class="input-group" style="flex:1;">
              <label class="label-form">Fecha/Hora Inicio <span class="required">(*)</span></label>
              <input type="datetime-local" id="ev-inicio">
            </div>
            <div class="input-group" style="flex:1;">
              <label class="label-form">Fecha/Hora Fin <span class="required">(*)</span></label>
              <input type="datetime-local" id="ev-fin">
            </div>
          </div>
          <div style="display:flex; gap:10px;">
            <div class="input-group" style="flex:1;">
              <label class="label-form">Tipo</label>
              <select id="ev-tipo" class="select-modern">
                <option value="Taller">Taller</option>
                <option value="Conferencia">Conferencia</option>
                <option value="CertificaciÃ³n">CertificaciÃ³n</option>
                <option value="Curso">Curso</option>
              </select>
            </div>
            <div class="input-group" style="flex:1;">
              <label class="label-form">Cupo MÃ¡x. <span class="required">(*)</span></label>
              <input type="number" id="ev-cupo" min="1">
            </div>
          </div>
          
          <div class="input-group">
            <label class="label-form">Correo del Docente Responsable <span class="required">(*)</span></label>
            <input type="email" id="ev-responsable" placeholder="docente@institucion.com">
          </div>
          
          <div style="display:flex; gap:10px; margin-top:10px;">
             <button id="btn-guardar-ev" class="btn-p" style="flex:1;" onclick="guardarEventoNuevo()" title="Guardar Evento">ğŸ’¾ <span class="btn-text">Guardar Evento</span></button>
             <button id="btn-borrar-ev" class="btn-alt" style="background:#ef4444; color:white; border:none; display:none;" onclick="borrarEventoActual()" title="Eliminar">ğŸ—‘ï¸ <span class="btn-text">Eliminar</span></button>
          </div>
        </div>
      </section>

      <section id="gestion-participantes" class="hidden animate-in">
        <div style="max-width: 500px; margin: 0 auto; background: var(--card-dark); padding: 2rem; border-radius: 20px;">
          <button class="btn-back" onclick="irAEventos()" title="Volver">â¬… <span class="btn-text">Volver</span></button>
          <button class="btn-alt" onclick="abrirModalCarga()" style="background:#059669; font-size:0.8rem;">ğŸ“‚ Carga Masiva (Excel)</button>
          <h2 style="margin-top:1.5rem;">InscripciÃ³n de Participantes</h2>
          <div class="input-group">
            <label class="label-form">Taller de Destino</label>
            <select id="p-evento-select" class="select-modern"></select>
          </div>
          <div class="input-group">
             <label class="label-form">Nombre Completo del Alumno <span class="required">(*)</span></label>
             <input type="text" id="p-nombre">
          </div>
          <div class="input-group">
            <label class="label-form">Correo ElectrÃ³nico del Alumno <span class="required">(*)</span></label>
            <input type="email" id="p-correo">
          </div>
          <button class="btn-p" style="width:100%;" onclick="guardarNuevoParticipante()" title="Validar e Inscribir">âœ… <span class="btn-text">Validar e Inscribir</span></button>
        </div>
      </section>

      <section id="asistencia-panel" class="hidden animate-in">
        <div style="padding: 0 5%;">
          <button class="btn-back" onclick="irAEventos()" title="Regresar a Cartelera">â¬… <span class="btn-text">Regresar a Cartelera</span></button>
          
          <div style="display:flex; justify-content:space-between; align-items:end; margin-top:1.5rem;">
            <div>
              <h2 id="evento-titulo" style="margin:0; color:var(--blue);"></h2>
              <p style="margin:5px 0 0 0; color:#64748b; font-size:0.9rem;">Gestiona la asistencia por dÃ­a.</p>
            </div>
            
            <div style="text-align:right; display:flex; gap:10px; align-items:flex-end;">
              <button onclick="verHistorial()" class="btn-alt" title="Ver Historial">ğŸ“Š <span class="btn-text">Ver Historial</span></button>
              <button class="btn-alt" onclick="iniciarEscaner()" style="background:#2563eb; margin-right:5px;" title="Escanear QR">ğŸ“· <span class="btn-text">Escanear QR</span></button>
              <button class="btn-secondary" onclick="cargarListaAsistencia(cursoActivoID)" title="Actualizar">ğŸ”„ <span class="btn-text">Recargar</span></button>
              <div>
                <label style="display:block; font-size:0.75rem; font-weight:bold; color:#94a3b8; margin-bottom:5px;">ğŸ“… Fecha de la SesiÃ³n</label>
                <input type="date" id="fecha-sesion-asist" class="input-flat" 
                       style="background:white; border:1px solid #cbd5e1; border-radius:8px; padding:8px;"
                       onchange="cargarAsistenciaDelDia()">
              </div>
            </div>
          </div>
          
          <div class="tabla-container" style="background:var(--card-dark); border-radius:15px; border:1px solid #334155; margin-top:20px;">
            <table style="width:100%; border-collapse: collapse;">
              <thead>
                <tr style="background:#1e293b; text-align:left;">
                  <th style="padding:15px;">Nombre del Alumno</th>
                  <th style="padding:15px; text-align:right;">Estatus / Check</th>
                </tr>
              </thead>
              <tbody id="lista-alumnos"></tbody>
            </table>
          </div>
          <div style="margin-top:20px; text-align:right;">
            <button class="btn-p" onclick="guardarAsistencia()" title="Guardar Asistencia del DÃ­a">ğŸ’¾ <span class="btn-text">Guardar Asistencia del DÃ­a</span></button>
          </div>
        </div>
      </section>

      <section id="horario-section" class="hidden animate-in">
        <div style="padding: 0 5%;">
          <button class="btn-back" onclick="irAEventos()" title="Volver">â¬… <span class="btn-text">Volver</span></button>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:1.5rem; margin-bottom:1rem;">
             <h2 style="margin:0;">Mi Agenda Personal</h2>
             <div style="display:flex; gap:10px;">
                <button class="btn-alt" onclick="toggleCalendario('list')" title="Lista">ğŸ“‹ <span class="btn-text">Lista</span></button>
                <button class="btn-alt" onclick="toggleCalendario('calendar')" title="Calendario">ğŸ“… <span class="btn-text">Calendario</span></button>
             </div>
          </div>

          <!-- VISTA LISTA -->
          <div id="view-lista-horario" class="tabla-container transition-opacity" style="background:var(--card-dark); border-radius:15px; padding:15px;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="border-bottom: 1px solid #334155; text-align:left;">
                  <th style="padding:10px;">Evento / Taller</th>
                  <th style="padding:10px;">Rol</th>
                  <th style="padding:10px; text-align:right;">Bloque Horario</th>
                </tr>
              </thead>
              <tbody id="lista-horario"></tbody>
            </table>
          </div>

          <!-- VISTA CALENDARIO -->
          <div id="view-calendar-horario" class="hidden transition-opacity" style="background:white; border-radius:15px; padding:15px; color:#1e293b;">
             <div id="calendar"></div>
          </div>
        </div>
      </section>

      <section id="usuarios-section" class="hidden animate-in">
        <div style="padding: 0 5%;">
          <div style="display:flex; justify-content:space-between; align-items:center;">
             <button class="btn-back" onclick="irAEventos()" title="Volver">â¬… <span class="btn-text">Volver</span></button>
             <h2 style="margin:0;">Panel de Usuarios</h2>
             <button class="btn-p" onclick="abrirModalUsuario()" title="Nuevo Usuario">â• <span class="btn-text">Nuevo Usuario</span></button>
          </div>
          <div class="tabla-container" style="background:var(--card-dark); border-radius:15px; padding:15px; margin-top:20px;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="border-bottom: 1px solid #334155; text-align:left;">
                  <th style="padding:10px;">Nombre</th>
                  <th style="padding:10px;">Identificador (Email)</th>
                  <th style="padding:10px; text-align:right;">Permisos / Acciones</th>
                </tr>
              </thead>
              <tbody id="lista-usuarios-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="logs-section" class="hidden animate-in">

        <div style="padding: 0 5%;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:20px; flex-wrap:wrap; gap:10px;">
             <div style="display:flex; align-items:center; gap:10px;">
                <button class="btn-back" onclick="irAEventos()" title="Volver">â¬… <span class="btn-text">Volver</span></button>
                <h2 style="margin:0; font-size:1.5rem;">Historial de AuditorÃ­a</h2>
             </div>
             
             <div style="display:flex; align-items:center; gap:10px;">
                <input type="text" id="busqueda-logs" placeholder="ğŸ” Buscar..." 
                       onkeyup="filtrarLogs()" 
                       style="padding: 6px 12px; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; font-size: 0.85rem; width: 200px;">
                <button class="btn-alt" onclick="cargarLogs()" style="padding: 6px 12px; font-size:0.9rem;">ğŸ”„</button>
             </div>
          </div>
          <div class="tabla-container" style="background:var(--card-dark); border-radius:15px; margin-top:20px; max-height: 550px; overflow-y: auto; border:1px solid #334155;">
            <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
              <thead style="position: sticky; top: 0; background: #1e293b; z-index:10;">
                <tr style="text-align:left;">
                  <th style="padding:12px;">Marca Temporal</th>
                  <th style="padding:12px;">Usuario</th>
                  <th style="padding:12px;">AcciÃ³n Realizada</th>
                  <th style="padding:12px;">DescripciÃ³n Detallada</th>
                </tr>
              </thead>
              <tbody id="lista-logs-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="notas-section" class="hidden animate-in">
        <div style="padding: 0 5%;">
          
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
             
             <div style="display:flex; gap:10px; align-items:center;">
                <button class="btn-back" onclick="irAEventos()" title="Volver">â¬… <span class="btn-text">Volver</span></button>
                <button class="btn-alt" onclick="cargarGradebook()" style="padding: 8px 12px; font-size: 1rem;" title="Recargar Promedios">ğŸ”„</button>
             </div>

             <h2 style="margin:0;">Libro de Calificaciones</h2>
             <button class="btn-p" onclick="abrirModalTarea()" title="Nueva Actividad">â• <span class="btn-text">Nueva Actividad</span></button>
          </div>
          
          <div class="table-responsive"> <table id="tabla-notas" style="width: 100%; border-collapse: collapse;">
     </table>
</div>
        </div>
      </section>

      <section id="crud-participantes-section" class="hidden animate-in">
        <div style="padding: 0 5%;">
          
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
             <button class="btn-back" onclick="irAEventos()">â¬… Volver</button>
             <h2 style="margin:0;">Directorio de Alumnos</h2>
             <div style="display:flex; gap:10px;">
                <button id="btn-borrar-seleccionados" class="btn-alt" style="background:#ef4444; color:white; border:none; display:none;" onclick="borrarSeleccionados()" title="Eliminar seleccionados">&#128465;&#65039; <span class="btn-text">Eliminar seleccionados (<span id="count-seleccionados">0</span>)</span></button>
                 <button class="btn-p" onclick="abrirModalCrearDesdeCrud()" title="Nuevo Alumno">â• <span class="btn-text">Nuevo Alumno</span></button>
                <button class="btn-alt" onclick="cargarTablaParticipantes()" title="Actualizar">ğŸ”„ <span class="btn-text">Actualizar</span></button>
             </div>
          </div>

          <div class="input-group">
            <input type="text" id="buscador-participantes" placeholder="ğŸ” Buscar por nombre, correo o curso..." 
                   onkeyup="filtrarTabla('tabla-participantes-body', this.value)" 
                   style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white;">
          </div>
          
          <div class="tabla-container" style="background:var(--card-dark); border-radius:15px; padding:15px; margin-top:10px; border:1px solid #334155;">
            <table style="width: 100%; border-collapse: collapse; min-width: 600px;">
              <thead>
                <tr style="border-bottom: 1px solid #334155; text-align:left; color:#94a3b8;">
                  <th style="padding:15px; width:40px;"><input type="checkbox" id="chk-select-all" onchange="toggleSelectAll(this)" title="Seleccionar todos" style="width:18px; height:18px; cursor:pointer;"></th>
                   <th style="padding:15px;">Nombre del Alumno</th>
                  <th style="padding:15px;">Correo</th>
                  <th style="padding:15px;">Curso / Taller Inscrito</th>
                  <th style="padding:15px; text-align:right;">Acciones</th>
                </tr>
              </thead>
              <tbody id="tabla-participantes-body"></tbody>
            </table>
          </div>
        </div>
      </section>
      <section id="reportes-section" class="hidden animate-in">
  <div style="padding: 0 5%;">
    
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
       <div>
         <h2 style="margin:0; color:#1e3a8a;">Centro de Reportes</h2>
         <p style="color:#64748b; margin:0;">Inteligencia de negocios y acadÃ©mica</p>
       </div>
       <button class="btn-back" onclick="irAEventos()">â¬… Volver</button>
    </div>

    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:15px; margin-bottom:30px;">
       
       <div onclick="cargarReporte('DOCENTES')" class="card-reporte">
          <div class="icon-rep">ğŸ‘¨â€ğŸ«</div>
          <div class="title-rep">DesempeÃ±o Docente</div>
       </div>

       <div onclick="cargarReporte('RIESGO')" class="card-reporte">
          <div class="icon-rep">ğŸš¨</div>
          <div class="title-rep">Alumnos en Riesgo</div>
       </div>

       <div onclick="cargarReporte('OCUPACION')" class="card-reporte">
          <div class="icon-rep">ğŸ“Š</div>
          <div class="title-rep">OcupaciÃ³n Cursos</div>
       </div>

       <div onclick="cargarReporte('DIPLOMAS')" class="card-reporte">
          <div class="icon-rep">ğŸ“</div>
          <div class="title-rep">AuditorÃ­a Diplomas</div>
       </div>

       <div onclick="cargarReporte('TOP')" class="card-reporte">
          <div class="icon-rep">ğŸ†</div>
          <div class="title-rep">Cuadro de Honor</div>
       </div>

       <!-- NUEVO REPORTE ENCUESTAS -->
       <div onclick="cargarReporte('ENCUESTAS')" class="card-reporte">
          <div class="icon-rep">â­</div>
          <div class="title-rep">SatisfacciÃ³n (Encuestas)</div>
       </div>

    </div>

    <div id="contenedor-reporte-resultado" class="hidden">
       <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
          <h3 id="titulo-reporte-dinamico" style="color:#334155; margin:0;">Resultado</h3>
          <button onclick="descargarTablaReporte()" class="btn-alt" style="font-size:0.8rem;">â¬‡ Descargar Excel</button>
       </div>
       
       <div class="tabla-container" style="background:var(--card-dark); border-radius:15px; padding:15px; border:1px solid #334155;">
          <table id="tabla-reporte-dinamica" style="width:100%; border-collapse: collapse; font-size:0.9rem;">
             </table>
       </div>
    </div>

  </div>
</section>

    </main>
  </div>
  <div id="modal-tarea" class="modal-overlay hidden">
    <div class="modal-card" style="width: 400px; max-width: 90%;">
      
      <input type="hidden" id="t-id"> 
      
      <div style="text-align: center; margin-bottom: 20px;">
        <h3 style="margin: 0; color: #1e293b;">GestiÃ³n de Actividad</h3>
        <p style="margin: 5px 0 0 0; font-size: 0.85rem; color: #64748b;">Define o actualiza la evaluaciÃ³n</p>
      </div>
      
      <div class="input-group">
        <label class="label-form">TÃ­tulo de la Actividad <span class="required">(*)</span></label>
        <input type="text" id="t-titulo" placeholder="Ej: Examen Parcial 1" class="input-flat" style="width: 100%; box-sizing: border-box;">
      </div>

      <div class="input-group">
        <label class="label-form">DescripciÃ³n (Opcional)</label>
        <input type="text" id="t-desc" placeholder="Ej: CapÃ­tulos 1 al 5" class="input-flat" style="width: 100%; box-sizing: border-box;">
      </div>

      <div class="input-group">
        <label class="label-form">PonderaciÃ³n (%)</label>
        <input type="number" id="t-peso" placeholder="Ej: 20" class="input-flat" style="width: 100%; box-sizing: border-box;" min="0">
        <small style="color: #64748b; font-size: 0.75rem;">El valor porcentual sobre la nota final.</small>
      </div>

      <div style="display:flex; gap:10px; margin-top:25px;">
        <button onclick="document.getElementById('modal-tarea').classList.add('hidden')" class="btn-back" style="flex:1;">Cancelar</button>
        <button onclick="guardarNuevaTarea()" class="btn-p" style="flex:1;">Guardar</button>
      </div>

    </div>
  </div>

  <div id="modal-usuario" class="modal-overlay hidden">
    <div class="modal-card">
       <h3 id="titulo-modal-u">Datos del Usuario</h3>
      <div class="input-group" style="text-align:left;">
        <label class="label-form">Nombre Completo <span class="required">(*)</span></label>
        <input type="text" id="u-nombre">
      </div>
      <div class="input-group" style="text-align:left;">
        <label class="label-form">Correo ElectrÃ³nico <span class="required">(*)</span></label>
        <input type="email" id="u-email">
      </div>
      <div class="input-group" style="text-align:left;">
        <label class="label-form">ContraseÃ±a de Acceso <span class="required">(*)</span></label>
        <input type="text" id="u-pass">
      </div>
      <div class="input-group" style="text-align:left;">
        <label class="label-form">Rol Asignado</label>
        <select id="u-rol" class="select-modern">
          <option value="docente">Docente</option>
          <option value="admin">Administrador</option>
          <option value="root">SuperUsuario (Root)</option>
        </select>
      </div>
      <div style="display:flex; gap:10px; margin-top:20px;">
        <button onclick="cerrarModalUsuario()" class="btn-back" style="flex:1;">Cancelar</button>
        <button onclick="guardarUsuario()" class="btn-p" style="flex:1;">Guardar Cambios</button>
      </div>
    </div>
  </div>



  <!-- SECCIÃ“N: GESTIÃ“N DE USUARIOS (FASE 19) -->
  <section id="usuarios-section" class="hidden animate-in">
     <div style="padding: 0 5%;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
           <h2 style="margin:0; color:#cbd5e1;">ğŸ‘¥ GestiÃ³n de Usuarios</h2>
           <button class="btn-back" onclick="irAEventos()">â¬… Volver</button>
        </div>
        
        <div class="card" style="margin-bottom:20px; background:#1e293b; color:white;">
           <div style="display:flex; justify-content:space-between; align-items:center; gap:15px;">
              <input type="text" id="filtro-usuarios" onkeyup="filtrarUsuarios()" placeholder="ğŸ” Buscar usuario..." style="background:#0f172a; border:1px solid #334155; color:white; flex:1; padding:10px; border-radius:8px;">
              <button class="btn" onclick="abrirModalUsuario('crear', null)">+ Nuevo Usuario</button>
           </div>
        </div>

        <div class="card" style="padding:0; overflow:hidden;">
           <div class="table-container" style="max-height:600px; overflow-y:auto;">
              <table style="width:100%; border-collapse:collapse;">
                 <thead style="position:sticky; top:0; background:#0f172a; color:white;">
                    <tr>
                       <th style="padding:15px; text-align:left;">Nombre</th>
                       <th style="padding:15px; text-align:left;">Email</th>
                       <th style="padding:15px; text-align:left;">Rol</th>
                       <th style="padding:15px; text-align:center; width:150px;">Acciones</th>
                    </tr>
                 </thead>
                 <tbody id="tabla-usuarios">
                    <!-- JS -->
                 </tbody>
              </table>
           </div>
        </div>
     </div>
  </section>

  <!-- MODAL: CREAR/EDITAR USUARIO -->
  <div id="modal-usuario-form" class="modal-overlay hidden">
    <div class="modal-card animate-in" style="max-width:500px;">
      <h3 id="usuario-modal-title">Nuevo Usuario</h3>
      <form id="form-usuario" onsubmit="guardarUsuario(event); return false;">
        <div class="input-group">
          <label class="label-form">Nombre Completo</label>
          <input type="text" id="usuario-nombre" required style="background:#0f172a; border:1px solid #334155; color:white; padding:10px; border-radius:8px; width:100%;">
        </div>
        
        <div class="input-group">
          <label class="label-form">Correo ElectrÃ³nico</label>
          <input type="email" id="usuario-email" required style="background:#0f172a; border:1px solid #334155; color:white; padding:10px; border-radius:8px; width:100%;">
        </div>
        
        <div class="input-group" id="grupo-password">
          <label class="label-form">ContraseÃ±a</label>
          <input type="password" id="usuario-password" style="background:#0f172a; border:1px solid #334155; color:white; padding:10px; border-radius:8px; width:100%;">
        </div>
        
        <div class="input-group">
          <label class="label-form">Rol</label>
          <select id="usuario-rol" required style="background:#0f172a; border:1px solid #334155; color:white; padding:10px; border-radius:8px; width:100%;">
            <option value="">Seleccionar...</option>
            <option value="docente">Docente</option>
            <option value="admin">Admin</option>
            <option value="root">Root</option>
          </select>
        </div>
        
        <div style="display:flex; gap:10px; margin-top:20px;">
          <button type="submit" class="btn" style="flex:1;">ğŸ’¾ Guardar</button>
          <button type="button" class="btn-alt" onclick="cerrarModalUsuario()" style="flex:1;">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="custom-modal" class="modal-overlay hidden">
    <div class="modal-card animate-in">
      <div id="modal-icon" style="font-size: 3.5rem; margin-bottom: 1rem;"></div>
      <h3 id="modal-title"></h3>
      <p id="modal-message" style="color: #94a3b8; margin-bottom: 1.5rem;"></p>
      <div id="modal-actions"></div>
    </div>
  </div>

  <div id="modal-scanner" class="modal-overlay hidden">
    <div class="modal-card" style="padding:0; overflow:hidden; max-width:500px;">
      <div style="background:#1e293b; padding:15px; display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0; color:white;">ğŸ“· EscÃ¡ner Activo</h3>
        <button onclick="detenerEscaner()" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">&times;</button>
      </div>
      <div style="padding:20px; background:black;">
        <div id="panel-contador" class="contador-container hidden">
  <div class="contador-card">
    <span class="contador-label">Presentes:</span>
    <span id="live-count-presentes" class="contador-numero val-presente">0</span>
    <span class="contador-divider">/</span>
    <span id="live-count-total" class="contador-numero val-total">0</span>
  </div>
</div>
        <div id="reader" style="width: 100%;"></div>
        <div id="scan-result" style="margin-top:10px; font-weight:bold; text-align: center; color: white;">Esperando cÃ³digo...</div>
      </div>
    </div>
  </div>

  <div id="modal-carga" class="modal-overlay hidden">
    <div class="modal-card">
      <h3>ğŸ“‚ Carga Masiva de Alumnos</h3>
      <p style="color:#94a3b8; font-size:0.9rem; margin-bottom:15px;">
        Sube un archivo <strong>.CSV</strong> con 2 columnas:<br>
        <code>Nombre Completo, Correo ElectrÃ³nico</code>
      </p>

      <div style="border: 2px dashed #475569; padding: 20px; border-radius: 10px; background: rgba(0,0,0,0.2); margin-bottom:20px;">
        <input type="file" id="archivo-csv" accept=".csv" style="color:white;">
      </div>

      <div id="preview-csv" style="max-height: 150px; overflow-y: auto; text-align: left; font-size: 0.8rem; background: #0f172a; padding: 10px; display:none; margin-bottom:15px; border-radius:5px;"></div>

      <div style="display:flex; gap:10px;">
        <button onclick="document.getElementById('modal-carga').classList.add('hidden')" class="btn-back" style="flex:1;">Cancelar</button>
        <button onclick="procesarArchivo()" class="btn-p" style="flex:1;">ğŸ“¤ Subir y Procesar</button>
      </div>
    </div>
  </div>

  <div id="modal-perfil-wide" class="modal-overlay hidden">
    <div class="modal-card animate-in" style="width: 680px; max-width: 95vw; padding: 0; overflow: hidden; background: #f8fafc; border-radius: 16px;">
      <div id="modal-perfil-content"></div>
    </div>
  </div>

  <div id="modal-anuncio" class="modal-overlay hidden">
    <div class="modal-card" style="width: 500px; max-width:95%;">
      <div style="text-align:center; margin-bottom:15px;">
        <span style="font-size:3rem;">ğŸ“¢</span>
        <h3>Enviar Comunicado</h3>
        <p style="color:#64748b; font-size:0.9rem;">Se enviarÃ¡ un correo a todos los alumnos inscritos.</p>
      </div>
      
      <div class="input-group">
        <label class="label-form">Asunto del Correo</label>
        <input type="text" id="anuncio-asunto" placeholder="Ej: Cambio de horario / Materiales">
      </div>
      
      <div class="input-group">
        <label class="label-form">Mensaje</label>
        <textarea id="anuncio-mensaje" rows="5" class="input-flat" 
                  style="border:1px solid #cbd5e1; width:100%; border-radius:10px; padding:10px; font-family:sans-serif;" 
                  placeholder="Escribe aquÃ­ los detalles..."></textarea>
      </div>

      <div style="display:flex; gap:10px; margin-top:20px;">
        <button onclick="document.getElementById('modal-anuncio').classList.add('hidden')" class="btn-back" style="flex:1;">Cancelar</button>
        <button onclick="enviarAnuncioBackend()" class="btn-p" style="flex:1;">ğŸ“¤ Enviar Aviso</button>
      </div>
    </div>
  </div>

  <div id="modal-analisis" class="modal-overlay hidden">
    <div class="modal-card" style="width: 750px; max-width: 95%;">
      <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #e2e8f0; padding-bottom:10px; margin-bottom:20px;">
         <h3 style="margin:0; color:#1e3a8a; display:flex; align-items:center; gap:10px;">
            ğŸ“Š AnÃ¡lisis de Rendimiento
         </h3>
         <button onclick="document.getElementById('modal-analisis').classList.add('hidden')" style="border:none; background:none; font-size:1.5rem; cursor:pointer; color:#64748b;">&times;</button>
      </div>

      <div style="display:flex; gap:25px; flex-wrap:wrap;">
         <div style="flex: 1; min-width: 300px; display:flex; flex-direction:column; gap:15px;">
            
            <div style="background:#f0fdf4; border:1px solid #bbf7d0; border-radius:8px; padding:15px;">
               <h4 style="margin:0 0 10px 0; color:#166534; font-size:0.95rem;">ğŸ† Cuadro de Honor (Top 3)</h4>
               <ul id="lista-top" style="padding-left:20px; margin:0; font-size:0.9rem; color:#15803d; line-height:1.6;">
                  <li>Cargando...</li>
               </ul>
            </div>

            <div style="background:#fef2f2; border:1px solid #fecaca; border-radius:8px; padding:15px;">
               <h4 style="margin:0 0 10px 0; color:#991b1b; font-size:0.95rem;">ğŸš¨ Alumnos en Riesgo</h4>
               <ul id="lista-riesgo" style="padding-left:20px; margin:0; font-size:0.9rem; color:#b91c1c; line-height:1.6;">
                  <li>Cargando...</li>
               </ul>
            </div>
         </div>

         <div style="flex: 1; min-width: 250px; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#f8fafc; border-radius:10px; padding:15px; border:1px solid #e2e8f0;">
            <h4 style="margin:0 0 10px 0; color:#475569; font-size:0.9rem;">Estatus del Grupo</h4>
            <div style="width:220px; height:220px;">
               <canvas id="chartAnalisis"></canvas>
            </div>
            <div style="margin-top:10px; font-size:0.8rem; color:#64748b; text-align:center;">Aprobados vs. No Aprobados</div>
         </div>
      </div>

      <div style="margin-top:25px; text-align:right; border-top:1px solid #e2e8f0; padding-top:15px;">
         <button onclick="document.getElementById('modal-analisis').classList.add('hidden')" class="btn-p">Cerrar Reporte</button>
      </div>
    </div>
  </div>

  <div id="modal-recuperacion" class="modal-overlay hidden">
    <div class="modal-card" style="width: 400px;">
      
      <div id="recup-paso-1">
         <h3 style="color:#2563eb;">ğŸ” Recuperar Acceso</h3>
         <p style="color:#64748b; font-size:0.9rem; margin-bottom:20px;">Ingresa tu correo y te enviaremos un cÃ³digo temporal.</p>
         
         <div class="input-group">
            <label class="label-form">Tu Correo ElectrÃ³nico</label>
            <input type="email" id="recup-email" placeholder="usuario@correo.com">
         </div>

         <button onclick="enviarSolicitudRecuperacion()" class="btn-p" style="width:100%;">Enviar CÃ³digo</button>
         <button onclick="cerrarModalRecuperacion()" class="btn-back" style="width:100%; margin-top:10px; border:none;">Cancelar</button>
      </div>

      <div id="recup-paso-2" class="hidden">
         <h3 style="color:#10b981;">ğŸ“© CÃ³digo Enviado</h3>
         <p style="color:#64748b; font-size:0.9rem; margin-bottom:15px;">Revisa tu correo e ingresa el cÃ³digo.</p>
         
         <div class="input-group">
            <label class="label-form">CÃ³digo de 6 DÃ­gitos</label>
            <input type="text" id="recup-token" placeholder="123456" style="letter-spacing: 3px; text-align: center; font-size: 1.2rem;">
         </div>

         <div class="input-group">
            <label class="label-form">Nueva ContraseÃ±a</label>
            <input type="password" id="recup-pass-new" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
         </div>

         <button onclick="confirmarCambioPass()" class="btn-p" style="width:100%; background:#10b981;">Cambiar ContraseÃ±a</button>
         <button onclick="volverAPaso1()" class="btn-back" style="width:100%; margin-top:10px; border:none;">AtrÃ¡s</button>
      </div>
    </div>
  </div>

  <div id="modal-tendencias" class="modal-overlay hidden">
    <div class="modal-card" style="width: 900px; max-width: 95%;">
      
      <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #e2e8f0; padding-bottom:15px; margin-bottom:20px;">
         <div>
           <h3 style="margin:0; color:#4f46e5;">ğŸ“ˆ Analytics del Curso</h3>
           <p style="margin:0; color:#64748b; font-size:0.9rem;">AnÃ¡lisis de evoluciÃ³n y deserciÃ³n</p>
         </div>
         <button onclick="document.getElementById('modal-tendencias').classList.add('hidden')" style="border:none; background:none; font-size:1.5rem; cursor:pointer;">&times;</button>
      </div>

      <div style="display:flex; gap:20px; flex-direction: column;">
         <div style="background:#fff; border:1px solid #e2e8f0; border-radius:10px; padding:15px;">
            <h4 style="margin:0 0 10px 0; color:#0f172a;">ğŸ“‰ Curva de Asistencia (DeserciÃ³n)</h4>
            <div style="height: 200px;">
               <canvas id="chartAsistencia"></canvas>
            </div>
         </div>

         <div style="background:#fff; border:1px solid #e2e8f0; border-radius:10px; padding:15px;">
            <h4 style="margin:0 0 10px 0; color:#0f172a;">ğŸ“Š EvoluciÃ³n del Promedio Grupal</h4>
            <div style="height: 200px;">
               <canvas id="chartNotas"></canvas>
            </div>
         </div>
      </div>

      <div style="margin-top:20px; text-align:right;">
         <button onclick="document.getElementById('modal-tendencias').classList.add('hidden')" class="btn-p">Cerrar</button>
      </div>
    </div>
  </div>

  <div id="modal-editar-participante" class="modal-overlay hidden">
    <div class="modal-card">
      <h3>âœï¸ Editar Datos del Alumno</h3>
      <input type="hidden" id="edit-p-id">
      
      <div class="input-group">
        <label class="label-form">Nombre Completo</label>
        <input type="text" id="edit-p-nombre">
      </div>
      <div class="input-group">
        <label class="label-form">Correo ElectrÃ³nico</label>
        <input type="email" id="edit-p-email">
      </div>
      
      <div style="display:flex; gap:10px; margin-top:20px;">
        <button onclick="document.getElementById('modal-editar-participante').classList.add('hidden')" class="btn-back" style="flex:1;">Cancelar</button>
        <button onclick="guardarEdicionParticipante()" class="btn-p" style="flex:1;">Guardar Cambios</button>
      </div>
    </div>
  </div>

  <div id="modal-crear-participante" class="modal-overlay hidden">
    <div class="modal-card">
      <h3>ğŸ“ Inscribir Nuevo Alumno</h3>
      
      <div class="input-group">
         <label class="label-form">Seleccionar Taller / Curso</label>
         <select id="new-p-evento" class="select-modern">
            <option value="">Cargando cursos...</option>
         </select>
      </div>

      <div class="input-group">
        <label class="label-form">Nombre Completo</label>
        <input type="text" id="new-p-nombre" placeholder="Ej: Juan PÃ©rez">
      </div>
      
      <div class="input-group">
        <label class="label-form">Correo ElectrÃ³nico</label>
        <input type="email" id="new-p-email" placeholder="alumno@correo.com">
      </div>
      
      <div style="display:flex; gap:10px; margin-top:20px;">
        <button onclick="document.getElementById('modal-crear-participante').classList.add('hidden')" class="btn-back" style="flex:1;">Cancelar</button>
        <button onclick="guardarNuevoPDesdeCrud()" class="btn-p" style="flex:1;">Inscribir Alumno</button>
      </div>
    </div>
  </div>

  <div id="modal-reporte" class="modal-overlay hidden">
    <div class="modal-card" style="max-width: 900px; width: 95%;">
      <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <h3>Historial de Asistencia</h3>
        <button onclick="document.getElementById('modal-reporte').classList.add('hidden')" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
      </div>
      
      <div style="overflow-x: auto;">
        <table id="tabla-reporte-matriz" style="width:100%; border-collapse: collapse; min-width: 600px;">
        </table>
      </div>
      
      <div style="margin-top:20px; text-align:right;">
        <button onclick="document.getElementById('modal-reporte').classList.add('hidden')" class="btn-p">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- MODAL DE CONFIRMACIÃ“N DE BORRADO -->
  <div id="modal-confirmar-borrado" class="modal-overlay hidden" style="z-index: 3000;">
    <div class="modal-card animate-in" style="width: 400px; text-align: center; border-top: 5px solid #ef4444;">
      <div style="background: #fef2f2; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto;">
         <span style="font-size: 2rem;">ğŸ—‘ï¸</span>
      </div>
      <h3 style="color: #1e293b; margin: 0;">Â¿EstÃ¡s seguro?</h3>
      <p style="color: #64748b; font-size: 0.9rem; margin: 10px 0 20px 0; line-height: 1.5;">
         Vas a eliminar esta actividad permanentemente. <br>
         <strong style="color: #ef4444;">SE PERDERÃN TODAS LAS NOTAS ASOCIADAS.</strong>
      </p>
      <div style="display: flex; gap: 10px; justify-content: center;">
         <button onclick="cerrarModalBorrado()" class="btn-back" style="flex: 1;">Cancelar</button>
         <button onclick="ejecutarBorradoTarea()" class="btn-p" style="flex: 1; background: #ef4444; border: 1px solid #dc2626;">SÃ­, Eliminar</button>
      </div>
    </div>
  </div>

  <!-- VISTA PREVIA PDF -->
  <div id="modal-preview-pdf" class="modal-overlay hidden" style="z-index: 2000;">
    <div class="modal-card" style="width: 800px; max-width: 95%; height: 85vh; padding: 0; display:flex; flex-direction:column; overflow:hidden;">
       <div style="padding:15px; background:#1e293b; display:flex; justify-content:space-between; align-items:center; color:white;">
          <h3 style="margin:0; font-size:1rem;">ğŸ‘ï¸ Vista Previa del Diploma</h3>
          <button onclick="document.getElementById('modal-preview-pdf').classList.add('hidden')" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">&times;</button>
       </div>
       <div style="flex:1; background:#334155; position:relative;">
          <div id="pdf-loader" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center; color:white;">
             <div style="font-size:3rem; animation: spin 1s linear infinite;">â³</div>
             <p style="margin-top:10px;">Generando vista previa...</p>
          </div>
          <iframe id="pdf-frame" style="width:100%; height:100%; border:none;" class="hidden"></iframe>
       </div>
    </div>
  </div>

  <style>
  @keyframes spin { 100% { transform: rotate(360deg); } }
  
  /* SISTEMA DE NOTIFICACIONES */
  .bell-container {
    position: relative;
    cursor: pointer;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;

  }
  </style>


  <!-- MODAL DE ENCUESTA -->
  <div id="modal-encuesta" class="modal-overlay hidden" style="z-index: 2100;">
    <div class="modal-card animate-in" style="width: 450px; max-width: 95%;">
      <div style="text-align: center; margin-bottom: 20px;">
        <span style="font-size: 3rem;">â­</span>
        <h3 id="encuesta-nombre-taller" style="margin: 10px 0 5px 0; color: #1e293b;">Calificar Taller</h3>
        <p style="color: #64748b; font-size: 0.9rem;">Tu opiniÃ³n nos ayuda a mejorar.</p>
      </div>

      <div class="survey-category">
        <label>SatisfacciÃ³n General</label>
        <div class="star-rating" data-categoria="general" data-value="0">
          <span class="star" data-value="1">â˜…</span>
          <span class="star" data-value="2">â˜…</span>
          <span class="star" data-value="3">â˜…</span>
          <span class="star" data-value="4">â˜…</span>
          <span class="star" data-value="5">â˜…</span>
        </div>
        <div id="lbl-general" class="rating-label"></div>
      </div>

      <div class="survey-category">
        <label>Calidad del Docente</label>
        <div class="star-rating" data-categoria="docente" data-value="0">
          <span class="star" data-value="1">â˜…</span>
          <span class="star" data-value="2">â˜…</span>
          <span class="star" data-value="3">â˜…</span>
          <span class="star" data-value="4">â˜…</span>
          <span class="star" data-value="5">â˜…</span>
        </div>
        <div id="lbl-docente" class="rating-label"></div>
      </div>

      <div class="survey-category">
        <label>Material DidÃ¡ctico</label>
        <div class="star-rating" data-categoria="material" data-value="0">
          <span class="star" data-value="1">â˜…</span>
          <span class="star" data-value="2">â˜…</span>
          <span class="star" data-value="3">â˜…</span>
          <span class="star" data-value="4">â˜…</span>
          <span class="star" data-value="5">â˜…</span>
        </div>
        <div id="lbl-material" class="rating-label"></div>
      </div>

      <div class="input-group" style="margin-top: 15px;">
        <label class="label-form">Comentarios Adicionales</label>
        <textarea id="encuesta-comentario" rows="3" class="input-flat" placeholder="CuÃ©ntanos mÃ¡s..."></textarea>
      </div>

      <div style="display: flex; gap: 10px; margin-top: 25px;">
        <button onclick="cerrarModalEncuesta()" class="btn-back" style="flex: 1;">Saltar</button>
        <button onclick="enviarEncuesta()" class="btn-p" style="flex: 1;">Enviar EvaluaciÃ³n</button>
      </div>
    </div>
  </div>

  <?!= incluir('js'); ?>
</body>
</html>
